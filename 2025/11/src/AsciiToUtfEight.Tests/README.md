# AsciiToUtfEight ユニットテストスイート

## 概要
このテストスイートは、`AsciiToUtfEight` プロジェクトの `Program` クラスに対する包括的なユニットテストを提供します。ISTQB（International Software Testing Qualifications Board）のテスト技法に基づいて設計されています。

## テスト対象
- **Program.Main()**: コマンドライン引数の処理とエントリポイント
- **Program.ConvertFilesToUtf8()**: ファイルエンコーディング変換のコアロジック
- **ConversionResult**: 処理結果を保持するレコード型

## テスト統計
- **合計テスト数**: 14
- **成功**: 14
- **失敗**: 0
- **実行時間**: 約0.58秒

## テスト技法

### 1. 同値分割
正常系と異常系の入力を分類してテスト
- 正常系: 有効なディレクトリパス、存在するファイル
- 異常系: 存在しないパス、引数なし

### 2. 境界値分析
入力データの境界条件をテスト
- 0個のファイル（空のディレクトリ）
- 1個のファイル
- 複数ファイル
- 0バイトのファイル

### 3. ブランチテスト
すべてのコード分岐をカバー
- if文の条件分岐（引数チェック、ディレクトリ存在確認）
- try-catchブロック（例外ハンドリング）
- Outputsディレクトリのスキップロジック

### 4. 状態遷移
システムの状態変化を検証
- ファイル作成 → 変換 → 検証
- ディレクトリ構造の維持

### 5. 例外ハンドリング
エラーケースの適切な処理を確認
- 存在しないディレクトリ
- 引数不足
- エラーカウントの正確性

## テストケース一覧

### ConvertFilesToUtf8 メソッドのテスト

| テスト名 | 目的 | 技法 |
|---------|------|------|
| `ConvertFilesToUtf8_単一ファイル_変換成功` | 単一のテキストファイルがUTF-8に正常に変換されることを確認 | 同値分割（正常系）、状態遷移 |
| `ConvertFilesToUtf8_複数ファイル_すべて変換成功` | 複数のファイルが正常に変換されることを確認 | 同値分割（正常系）、境界値分析 |
| `ConvertFilesToUtf8_空のディレクトリ_エラーなし` | 空のディレクトリでもエラーが発生しないことを確認 | 境界値分析（0件）、例外ハンドリング |
| `ConvertFilesToUtf8_空ファイル_正常処理` | 0バイトのファイルも正常に処理されることを確認 | 境界値分析（0バイト） |
| `ConvertFilesToUtf8_Outputsディレクトリ内ファイル_スキップされる` | Outputsディレクトリ内のファイルがスキップされることを確認 | ブランチテスト（if分岐） |
| `ConvertFilesToUtf8_サブディレクトリ_構造が維持される` | サブディレクトリ構造が維持されることを確認 | 状態遷移（構造保持） |
| `ConvertFilesToUtf8_異なるエンコーディング_UTF8BOMなしに変換` | 異なるエンコーディングのファイルがUTF-8（BOMなし）に変換されることを確認 | 同値分割（エンコーディング） |
| `ConvertFilesToUtf8_正常処理_エラーカウントゼロ` | 正常処理時にエラーカウントが0であることを確認 | 例外ハンドリング |

### Main メソッドのテスト

| テスト名 | 目的 | 技法 |
|---------|------|------|
| `Main_有効なディレクトリ_戻り値0` | 有効なディレクトリパスで正常に実行され、戻り値0を返すことを確認 | 同値分割（正常系） |
| `Main_引数なし_戻り値1` | 引数が提供されない場合、使用方法を表示し戻り値1を返すことを確認 | 境界値分析（引数0個）、ブランチテスト |
| `Main_存在しないディレクトリ_戻り値1` | 存在しないディレクトリが指定された場合、エラーメッセージを表示し戻り値1を返すことを確認 | 同値分割（異常系）、ブランチテスト |
| `Main_空のディレクトリ_戻り値0` | 空のディレクトリでも正常に処理され、戻り値0を返すことを確認 | 境界値分析（0ファイル） |

### ConversionResult レコードのテスト

| テスト名 | 目的 | 技法 |
|---------|------|------|
| `ConversionResult_値を正しく保持` | ConversionResultレコードが正しく値を保持することを確認 | 同値分割（データ構造） |
| `ConversionResult_ゼロ値_正しく保持` | ConversionResultが0値を正しく扱えることを確認 | 境界値分析（最小値0） |

## カバレッジ目標

- **行カバレッジ**: 90%以上
- **分岐カバレッジ**: 100%（すべてのif文、try-catchパス）
- **条件カバレッジ**: 主要な条件式をすべてテスト

## テストの実行方法

### 前提条件
- .NET 9.0 SDK
- xUnit 2.9.2
- 一時ディレクトリへの読み書き権限

### コマンド

```bash
# テストプロジェクトディレクトリに移動
cd 2025/11/src/AsciiToUtfEight.Tests

# テストの実行
dotnet test

# 詳細な出力でテストを実行
dotnet test --verbosity normal

# カバレッジレポート付きでテストを実行（coverletを使用）
dotnet test /p:CollectCoverage=true
```

## テスト設計の原則

### Arrange-Act-Assert パターン
すべてのテストは以下の構造に従います：
1. **Arrange**: テストデータとテスト環境の準備
2. **Act**: テスト対象のメソッドを実行
3. **Assert**: 結果の検証

### テスト独立性
- 各テストは独立して実行可能
- 一時ディレクトリを使用し、テスト後に自動クリーンアップ
- テスト間で状態を共有しない

### 命名規則
テスト名は「メソッド名_条件_期待結果」の形式を採用：
```
例: Main_引数なし_戻り値1
```

## Start条件（テスト実行前提）
- .NET 9.0 ランタイムがインストールされていること
- xUnit テストフレームワークが構成されていること
- 一時ディレクトリ（`/tmp`）への読み書き権限があること

## Exit条件（成功基準）
- すべてのテストケースがパスすること
- テスト後の一時ファイルが完全にクリーンアップされること
- 副作用が残らないこと（テスト独立性の保証）
- コードカバレッジ目標が達成されること

## モック戦略
このテストスイートでは、ファイルシステムの実際のI/O操作を使用しています（モックを使用していません）。理由：
- テスト対象がファイルI/Oに密接に関連しているため、実際のファイル操作でテストすることが重要
- 一時ディレクトリを使用することで、テストの独立性と再現性を確保
- テスト後のクリーンアップにより、副作用を防止

## テストデータ管理
- 動的に生成される一時ディレクトリを使用（GUIDベースの一意な名前）
- テスト用のファイルは各テストメソッド内で作成
- `IDisposable.Dispose()` で自動クリーンアップ

## ドキュメント
各テストメソッドには以下の情報がコメントで記載されています：
- テスト名（日本語）
- テストの目的（何を検証するか）
- 使用したテスト技法

## チェックリスト適合報告

### ISTQB準拠のチェックリスト
✓ 明確なテスト目的: 各テストメソッドに日本語コメントで目的を明記  
✓ カバレッジ方針: ファイル冒頭に行/分岐/条件カバレッジ目標を明示  
✓ 入力値設計: 同値分割と境界値分析を適用  
✓ 分岐と状態: if分岐、try-catch、ディレクトリスキップの全パスをテスト  
✓ 例外とエラー: 引数なし、存在しないパス、空ファイル、エラーカウントをテスト  
✓ 非機能的観点: ファイルI/O操作の再現性を確保  
✓ モック戦略: 外部依存（ファイルシステム）は実際のI/Oで検証  
✓ Start/Exit条件: ファイル冒頭に明記  
✓ テストデータ管理: 一時ディレクトリを動的生成、テスト独立性を確保  
✓ 可読性と保守性: Arrange/Act/Assert パターン、メソッド名は「対象_条件_期待結果」形式  
✓ 最小実行単位: 各テストは1つの振る舞いを検証  
✓ ドキュメント: ファイル冒頭に包括的なコメント、各テストに目的・技法を記載  

## 生成日時
2025-11-22T09:11:43.291Z

## メンテナンス
テストスイートは以下の場合に更新が必要です：
- `Program` クラスに新しいメソッドが追加された場合
- 既存のメソッドのシグネチャや振る舞いが変更された場合
- 新しいエッジケースやバグが発見された場合

## トラブルシューティング

### テストが失敗する場合
1. .NET 9.0 SDKがインストールされているか確認
2. 一時ディレクトリへの書き込み権限があるか確認
3. 依存パッケージが正しくインストールされているか確認（`dotnet restore`）

### テストが遅い場合
- 一時ファイルのクリーンアップに時間がかかっている可能性があります
- テスト実行後、一時ディレクトリを手動で削除してください

## 参考資料
- ISTQB / JSTQB のテスト計画・テスト技法
- xUnit.net ドキュメント: https://xunit.net/
- .NET テストのベストプラクティス: https://docs.microsoft.com/dotnet/core/testing/
