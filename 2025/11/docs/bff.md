# BFF (Backend For Frontend)

BFF はフロントエンド固有の API を提供し、複数のマイクロサービスへの呼び出しを集約してフロントエンドに最適化されたレスポンスを返します。セキュリティ面ではフロントエンドとバックエンドの間のトークン管理やヘッダ注入を担当します。

## 主な責務
- フロントエンドに最適化された API の提供
- 認証トークンの検証・管理（必要に応じて認証サービスへ委譲）
- 複数サービスからのデータ集約・変換
- キャッシュとレート制御（フロントエンド向けの短期キャッシュ）

## 代表エンドポイント例
- POST /bff/auth/login -> 認証サービスへ委譲
- GET /bff/users/me -> User Management + Profile 情報を集約
- GET /bff/todos?filter=... -> ToDo サービスにプロキシ
- POST /bff/files/upload -> File Sharing サービスへ署名アップロード URL を取得

## デザイン方針
- API は画面ベースで設計し、必要なデータだけを返す（過剰なネストや大量のリレーションは避ける）。
- 同期呼び出しは短時間で終わることを前提にし、長時間処理は非同期ワークフローに切り出す。
- キャッシュは BFF 層で短期キャッシュ（e.g. in-memory / Redis）を行い、User Management など参照頻度の高いエンドポイントを最適化する。

## セキュリティ
- フロントエンドは BFF のみを呼び出し、BFF がバックエンドへのクレデンシャル/トークンを管理する。
- BFF と他サービス間は mTLS または Azure AD のサービスプリンシパルを利用する。

## エラーハンドリング
- バックエンドのエラーは BFF で一元変換し、フロントエンドにフレンドリなエラーコードとメッセージを返す。
- リトライ可能な障害は BFF の再試行ロジックで対応（exponential backoff）。

## Observability
- BFF はリクエスト/レスポンスのログ、サマリーメトリクス、分散トレースを出力する。

---

作成者: GitHub Copilot デモ用アウトライン
