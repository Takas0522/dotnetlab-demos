---
title: 設計: 認証サービスにユーザーIDクレームとロール追加
assignee: dev
effort: small
dependencies: []
---

## 概要
認証 (Auth) サービスの JWT 発行処理を変更し、すべてのサービスが利用可能な `userId` クレーム（GUID形式）をトークンに含めます。さらにポイント管理者向けの新ロール `points_admin` を追加し、ロール付与の運用フローをドキュメント化します。

## 説明
- JWT に現在未採用の `userId` クレームを追加することで、各マイクロサービスは `sub` に依存せず確実にユーザー識別ができるようにします。
- `points_admin` ロールを導入し、ポイントの付与・調整を行える管理者権限を定義します。
- 既存クライアントとの互換性（既存クレームの扱い、トークンサイズ、配信タイミング）について検討・ドキュメント化します。

## 受け入れ基準
- Auth サービスが新しい JWT を発行できる（`userId` クレームを含む）こと。
- `points_admin` ロールが定義され、ロール付与手順が `docs/authentication.md` に記載されていること。
- 既存サービスが新クレームを適切に扱うための互換性案が提示されていること。

## 備考
- トークンフォーマット変更は順次デプロイでロールアウトすること。クライアント側の検証や BFF の処理についても確認が必要。
